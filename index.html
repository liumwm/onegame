<html>
 <head>
  <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>躲小球</title>
  <style>
    canvas{
      background-color:#006EFF;
      width:100%
      }
    button{
      position:relative;
      border:0.05px solid red;
      background-color:#ffffff;
      }
    *{
      user-select:none;
      }
    .b{
      width:30px;
      height:30px;
      }
     html, body{
       overflow:hidden;
       }
  </style>
 </head>
 <body>
  <div id="lmdlook" style="opacity:0.5;position:absolute;background-color:blue;"></div>
  <div><b><p id="fs" style="position:absolute;left:12px;top:-8px;color:yellow;"></p></b> <b><p id="zgfs" style="position:absolute;color:yellow;"></p></b> <b><p id="bcdf" style="position:absolute;color:yellow;top:30;"></p></b>
   <canvas id="ck" width="400" height="400"></canvas>
  </div> <button id="ks" style="display:block;" onclick="if(yx){yx=false;document.getElementById('ks').innerHTML='开始游戏'} else{yx=true;document.getElementById('ks').innerHTML='暂停游戏';if(dr.length===0){creat();x=200;y=200;document.getElementById('zgfs').innerHTML='';document.getElementById('bcdf').innerHTML=''}}">开始游戏</button>
  <div id="kz" style="position:absolute;left:200;top:300;z-index:999;">
   <div id="dz" style="opacity:0.8;width:100px;height:100px;background-color:#808080;border-radius:50px;">
    <div id="ition" style="position:relative;top:30;left:30;">
     <div id="yg" style="opacity:0.8;position:relative;width:40px;height:40px;background-color:#c0c0c0;border-radius:20px;">
     </div>
    </div>
   </div>
  </div>
  <div style="position:absolute;top:85%;left:70%;z-index:99;"><button class="b" onclick="if(dx1<100){dx1+=2}">+</button> <button class="b" onclick="if(dx1>18){dx1-=2}">-</button>
  </div> <button id="diy" onclick="if(diyy){diyy=false;document.getElementById('diy').innerHTML='自定义按钮位置:off'} else{diyy=true;document.getElementById('diy').innerHTML='自定义按钮位置:on'}">自定义按钮位置:off</button>
  <div style="height:20px;">
   调节:<input id="nd" type="number" value="0" style="user-select:none;"><input type="submit" value="ok" onclick="shez();">
  </div>
  <div style="position:relative;">
  <p id="lmdp" style="position:relative;top:-5px;display:inline-block;font-size:13px;">遥感灵敏度:20</p>
  <br><input id="lmd" type="range" min="0" max="40" style="position:relative;top:-20px;overflow:auto;"/>
  </div>
  <p id="cs"></p>
  <div style="position:absolute;top:80%;z-index:-10;"><i><p style="color:aqua;font-size:10px;">感谢游玩<br><strong>game by liumwm</strong></p></i>
  </div>
  <script>
  let huadom=true
  let kztj=false
  function randomint(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
function shez(){
  ndd=document.getElementById("nd").value
}
  class drc{
    constructor(){
      this.dx=randomint(0,400)
      this.dy=randomint(0,100)
      this.ds=0
      }
    }
  function creat(){
  dr.push(new drc())
  }
  let ndd=0
  let wd=false
  let diyy=false
  let yx=false
  let dr=[]
  eeee=document.getElementById("ck")
  c=eeee.getContext("2d")
  let bc=400
  let x=bc/2
  let y=bc/2
  let cc=0
  let ccc=0
  let zg=0
  let dx=290
  let dx1=80
  let kzz=document.getElementById("kz")
  let ygg=document.getElementById("yg")
  let lm=12
  ygg.addEventListener("touchstart",function(){
      kztj=true
      huadom=false
      })
  document.addEventListener("touchmove",function(event){
   if(!huadom){
   event.preventDefault();
   }
   let touch=event.touches[0]
   let tx=touch.clientX
   let ty=touch.clientY
   let kzx=parseFloat(kz.style.left)
   let kzy=parseFloat(kz.style.top)
   if(diyy==false && kztj){
    let s=Math.sqrt((tx-(kzx+50))**2+(ty-(kzy+50))**2)
    // document.getElementById("cs").innerHTML=parseInt(s)+ygg.style.left+","+ygg.style.top
    if(s<50){
    ygg.style.left=tx-parseInt(kz.style.left)-50
    ygg.style.top=ty-parseInt(kz.style.top)-50
    } else{
    deg=Math.atan2(ty-kzy-50,tx-kzx-50)
    ygx=kzx-50*Math.cos(deg)
    ygy=kzy-50*Math.sin(deg)
    yg.style.left=kzx-ygx
    yg.style.top=kzy-ygy
    }
   }
   if(diyy && event.touches.length>0){
     if(tx<window.innerWidth-100){
    kzz.style.left=tx-50
    }
     if(ty<window.innerHeight-100){
    kzz.style.top=ty-50
    }
    }
    }, { passive: false })
  document.addEventListener("touchend",function(){
      ygg.style.left=0
      ygg.style.top=0
      kztj=false
      huadom=true
      })
  document.addEventListener("touchstart",function(){
      lmdlook.style.width=0+"px"
      lmdlook.style.height=0+"px"})
  lmd.oninput=function (){
  lmdp.innerHTML="遥感灵敏度:"+this.value
  lm=this.value
  lmdlook.style.width=this.value*2
  lmdlook.style.height=this.value*2
  lmdlook.style.left=-this.value+parseFloat(kz.style.left)+50
  lmdlook.style.top=-this.value+parseFloat(kz.style.top)+50
  }
  function d(){
  document.getElementById("fs").innerHTML=ccc
  document.getElementById("ck").style.width=dx1+"%"
  c.clearRect(0,0,bc,bc)
  c.fillStyle="rgb(225,105,0)"
  c.fillRect(x,y,10,10)
  if(yx){
  dr.forEach((i) => {
    jcx=(x+5)-i.dx
    jcy=(y+5)-i.dy
    jc=Math.sqrt(jcx**2+jcy**2)
    if(jc<15 && !wd){
    yx=false
    if(ccc>zg){
    zg=ccc
    }
    document.getElementById("bcdf").innerHTML="本次得分:"+ccc
    ccc=0
    x=200
    y=200
    cc=0
    document.getElementById("ks").innerHTML="开始游戏"
    document.getElementById("zgfs").innerHTML="最高得分:"+zg
    dr=[]
    }
  c.fillStyle="rgb(0,255,0)"
  c.beginPath()
  c.arc(i.dx,i.dy,10,0,3.141592653589793*2)
  c.fill()
  i.ds+=0.35
  i.dy+=i.ds+Number(ndd)
  if(i.dy>420){
  i.dy=-20
  i.dx=randomint(0,400)
  cc+=1
  i.ds=0
  if(cc>=ccc){
  creat()
  cc=0
  ccc=ccc+1
  }
  }
    })
  }
  setTimeout(d,20);
  }
  d()
  function kzf(){
  if(parseFloat(ygg.style.left)<-lm){
  xjpppp()
  }
  if(parseFloat(ygg.style.left)>lm){
  xj()
  }
  if(parseFloat(ygg.style.top)<-lm){
  yjpppp()
  }
  if(parseFloat(ygg.style.top)>lm){
  yj()
  }
  setTimeout(kzf,4.5);
  }
  kzf()
  function xj(){
  if(x<390){
  x=x+1
  }
  }
  function xjpppp(){
  if(x>0){
  x=x-1
  }
  }
  function yj(){
  if(y<390){
  y=y+1
  }
  }function yjpppp(){
  if(y>0){
  y=y-1
  }
  }
  </script>
  <script>
  // ===== 电脑端适配代码开始（不要修改原有代码）=====
  // 仅当在非触摸设备或PC上时启用鼠标控制
  if (window.matchMedia("(pointer: fine)").matches) {
    const canvas = document.getElementById("ck");
    const ball = { x: 200, y: 200 }; // 与原代码中的 x, y 保持同步，但这里用于鼠标跟随

    // 监听鼠标在 canvas 区域内的移动
    canvas.addEventListener("mousemove", function (evt) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = evt.clientX - rect.left;
      const mouseY = evt.clientY - rect.top;

      // 将画布中的鼠标坐标映射回游戏坐标（注意你的小球大小是10x10，中心点对齐）
      ball.x = Math.max(5, Math.min(mouseX - 5, canvas.width - 5));
      ball.y = Math.max(5, Math.min(mouseY - 5, canvas.height - 5));
    });

    // 注：下面重写绘制和碰撞检测中的 x, y 为 ball.x, ball.y
    // 但是我们不能直接修改原代码的 x, y，所以采用“覆盖绘制”的方式

    // 保存原绘制的 d() 函数引用
    const originalDFunction = d;

    // 重写 d() 函数，在原逻辑之前先更新 c 中的 x, y 为 ball.x, ball.y
    window.d = function () {
      // 将电脑鼠标的 ball.x, ball.y 同步到原全局变量 x, y，使得碰撞检测和绘制生效
      x = ball.x;
      y = ball.y;

      // 调用原来的 d() 函数逻辑
      originalDFunction();
    };
  }

  // 可选：键盘方向键控制（额外功能，非必须）
  if (window.matchMedia("(pointer: fine)").matches) {
    const step = 5;
    document.addEventListener("keydown", function (e) {
      switch (e.key) {
        case "ArrowLeft":
          if (x > 5) x -= step;
          break;
        case "ArrowRight":
          if (x < 395) x += step;
          break;
        case "ArrowUp":
          if (y > 5) y -= step;
          break;
        case "ArrowDown":
          if (y < 395) y += step;
          break;
      }
    });
  }
  // ===== 电脑端适配代码结束 =====
</script>

 </body>
</html>